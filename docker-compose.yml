version: '3.8'

services:
  # Frontend - Next.js Client (Customer-facing website)
  frontend:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - NEXT_PUBLIC_BACKEND_URL=https://api.shonra.com
        - NEXT_PUBLIC_SITE_URL=https://shonra.com
        - NEXT_PUBLIC_ENABLE_AI_SEO=false
    container_name: shonra-frontend
    image: shonra-frontend:latest
    env_file:
      - stack.env
    environment:
      # Server-side API routes need BACKEND_URL (not NEXT_PUBLIC_BACKEND_URL)
      # Use internal Docker network name for better performance
      # Service name must match the service name in server/docker-compose.yml (backend-api)
      - BACKEND_URL=http://backend-api:3002
      # Fallback to public URL if internal network doesn't work (uncomment if needed)
      # - BACKEND_URL=https://api.shonra.com
    restart: always
    # Expose port for internal network access (nginx-proxy)
    expose:
      - '3000'
    # Optional: Map port to host for direct access (for debugging)
    # Uncomment if you need direct access from host
    # ports:
    #   - '3000:3000'
    networks:
      - shonra-network
    # Resource limits
    deploy:
      resources:
        limits:
          cpus: '0.5'
          memory: 1G
        reservations:
          cpus: '0.25'
          memory: 512M

networks:
  shonra-network:
    external: true

